---
title: "Report Draft"
format: html
editor: visual
runtime: shiny
---

```{r setup, include=FALSE}
library(shiny)
library(tidyverse)
library(plotly)

pitching <- read.csv("data/The History of Baseball dataset/pitching.csv")
batting <- read.csv("data/The History of Baseball dataset/batting.csv")

# Group years into decades
pitching <- pitching %>%
  mutate(decade = paste0(floor(year / 10) * 10, "s"))

# Add batting average to pitching
bat_sm <- batting %>% 
  mutate(batt_avg = h/ab) %>% 
  select(player_id, year, batt_avg)

pitching_2 <- pitching %>% 
  filter(year >= 1985) %>% 
  left_join(bat_sm)
```

### Introduction/Motivation, Research question, & Background

- What question are you trying to answer?

- Why is it important or interesting?

- If needed, What background information is necessary here?

- If needed, What assumptions or terms or acronyms need to be clarified?


### Data

- Data collection: What was collected, When was it collected, Why was it collected, How was it collected originally, Who collected it

- Data acquisition: Where / how did you get the data? What is the source?

- Data understanding: How much data do you have? What types of measurements? Anything you needed to clean before getting started?

```{r}
#TODO: Add numerical summaries?
```

## Wins and Losses per Team
```{r}
# TODO: Add alt-cap, make sure color palette is accessible

# Define UI for selecting a decade
selectInput("selected_decade", 
            "Choose a Decade:", 
            choices = unique(pitching$decade), 
            selected = unique(pitching$decade)[1])

# Render the plot dynamically
renderPlot({
  filtered_data <- pitching %>% filter(decade == input$selected_decade)
  
  ggplot(filtered_data, aes(x = team_id, group = league_id)) +
    geom_bar(aes(y = w, fill = "Wins"), stat = "identity", position = "dodge",alpha = 0.4) +
    geom_bar(aes(y = l, fill = "Losses"), stat = "identity", position = "dodge",alpha = 0.4) +
    labs(title = paste("Wins and Losses in", input$selected_decade), 
         x = "Year", y = "Count") +
    scale_fill_manual(values = c("Wins" = "blue", "Losses" = "red")) +
    theme_minimal()+
    theme(axis.text.x = element_text(angle = 45, hjust = 1))# Rotate team labels for clarity

})

```

### Data Insights

What are the important takeaways from the data? What was interesting?

Why do these takeaways matter?

Was there anything surprising?

Overall, what do you want the audience to walk away with? What do you want them to understand about your data and research 
questions?!?


## Strikeouts VS Walks
```{r}
# TODO: Add alt-cap, make sure color palette is accessible

# UI to select filters
sidebarLayout(
  sidebarPanel(
    sliderInput("top_n", 
                "Select Top N Players by Strikeouts:", 
                min = 5, max = 50, value = 10, step = 5),
    selectInput("filter_team", 
                "Filter by Team (Optional):", 
                choices = c("All", unique(pitching$team_id)), 
                selected = "All")
  ),
  mainPanel(
    plotOutput("hr_bb_plot")
  )
)

# Server logic
renderPlot({
  # Filter and sort data
  filtered_data <- pitching %>%
    filter(if (input$filter_team != "All") team_id == input$filter_team else TRUE) %>%
    arrange(desc(hr)) %>%
    slice_head(n = input$top_n)  # Top N players
  
  ggplot(filtered_data, aes(x = bb, y = so, color = player_id, label = player_id)) +
    geom_point(size = 3, alpha = 0.7) +
    geom_text(vjust = -0.5, size = 3) +
    labs(title = "Strikeouts vs. Walks", 
         x = "Walks (BB)", y = "Strikeouts (SO)") +
    theme_minimal() +
    theme(legend.position = "none")

})
```

### Data Insights

What are the important takeaways from the data? What was interesting?

Why do these takeaways matter?

Was there anything surprising?

Overall, what do you want the audience to walk away with? What do you want them to understand about your data and research 
questions?!?


## Strikeouts VS Wins Since 1985
```{r}
# still a WIP, feel free to mess around with it
# TODO: Add alt-cap, make sure color palette is accessible

pitching %>% 
  filter(year >= 1985, so >= 5) %>% 
  ggplot(aes(x = so, y = w)) +
  geom_point() +
  geom_smooth(method = "lm") +
  labs(title = "Strikeouts vs Wins since 1985", x = "Strikeouts (SO)", y = "Wins (W)")
```

### Data Insights

What are the important takeaways from the data? What was interesting?

Why do these takeaways matter?

Was there anything surprising?

Overall, what do you want the audience to walk away with? What do you want them to understand about your data and research 
questions?!?


## Batting Average VS Wins Since 1985
```{r}
# still a WIP, feel free to mess around with it maybe add an interactive team selector?
# TODO: Add alt-cap, make sure color palette is accessible

bat_sm <- batting %>% 
  mutate(batt_avg = h/ab) %>% 
  select(player_id, year, batt_avg)

pitching_2 <- pitching %>% 
  filter(year >= 1985) %>% 
  left_join(bat_sm)
  
pitching_2 %>% 
  filter(!is.na(batt_avg)) %>% 
  ggplot(aes(x = batt_avg, y = w, group = team_id)) +
  geom_boxplot()
```

### Data Insights

What are the important takeaways from the data? What was interesting?

Why do these takeaways matter?

Was there anything surprising?

Overall, what do you want the audience to walk away with? What do you want them to understand about your data and research 
questions?!?



### Conclusion/Big Picture

How do the insights connect to answer your research question?

What improvements might someone make to your analysis?

Are there any limitations or weaknesses of your data / analysis?
